<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 蜡笔-小新</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta name="description" content="前端*前端">
    
    <link rel="preload" href="/assets/css/0.styles.59073369.css" as="style"><link rel="preload" href="/assets/js/app.ae35c946.js" as="script"><link rel="preload" href="/assets/js/4.7a9925ca.js" as="script"><link rel="preload" href="/assets/js/43.5cf73da3.js" as="script"><link rel="prefetch" href="/assets/js/1.a85f77d0.js"><link rel="prefetch" href="/assets/js/10.4437fbd9.js"><link rel="prefetch" href="/assets/js/11.fc0caee6.js"><link rel="prefetch" href="/assets/js/12.9ae12081.js"><link rel="prefetch" href="/assets/js/13.a236975b.js"><link rel="prefetch" href="/assets/js/14.c970eefa.js"><link rel="prefetch" href="/assets/js/15.6ed1e1eb.js"><link rel="prefetch" href="/assets/js/16.da7bd798.js"><link rel="prefetch" href="/assets/js/17.ff8b8b21.js"><link rel="prefetch" href="/assets/js/18.daac6fd8.js"><link rel="prefetch" href="/assets/js/19.924e0828.js"><link rel="prefetch" href="/assets/js/20.e3a628d6.js"><link rel="prefetch" href="/assets/js/21.32f56551.js"><link rel="prefetch" href="/assets/js/22.6840f6f6.js"><link rel="prefetch" href="/assets/js/23.179fd3a2.js"><link rel="prefetch" href="/assets/js/24.051dea42.js"><link rel="prefetch" href="/assets/js/25.afb1d0c6.js"><link rel="prefetch" href="/assets/js/26.32d8d928.js"><link rel="prefetch" href="/assets/js/27.65e36429.js"><link rel="prefetch" href="/assets/js/28.2f4d7c6a.js"><link rel="prefetch" href="/assets/js/29.7b243c60.js"><link rel="prefetch" href="/assets/js/3.3a4b3e43.js"><link rel="prefetch" href="/assets/js/30.200349ab.js"><link rel="prefetch" href="/assets/js/31.0169f5d4.js"><link rel="prefetch" href="/assets/js/32.d7801ef7.js"><link rel="prefetch" href="/assets/js/33.998f2e93.js"><link rel="prefetch" href="/assets/js/34.25baceac.js"><link rel="prefetch" href="/assets/js/35.90337bb9.js"><link rel="prefetch" href="/assets/js/36.38257457.js"><link rel="prefetch" href="/assets/js/37.81238058.js"><link rel="prefetch" href="/assets/js/38.2d537690.js"><link rel="prefetch" href="/assets/js/39.81a6596a.js"><link rel="prefetch" href="/assets/js/40.d1a1ad8c.js"><link rel="prefetch" href="/assets/js/41.250ffa61.js"><link rel="prefetch" href="/assets/js/42.8d208f71.js"><link rel="prefetch" href="/assets/js/5.91ba935f.js"><link rel="prefetch" href="/assets/js/6.59f2c097.js"><link rel="prefetch" href="/assets/js/7.7df142e3.js"><link rel="prefetch" href="/assets/js/8.c680a939.js"><link rel="prefetch" href="/assets/js/9.19cdaf0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.59073369.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">蜡笔-小新</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/javascript/common.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/cleanheart/miscellaneous/sentence.html" class="nav-link">
  杂六
</a></div><div class="nav-item"><a href="https://github.com/Crayon-F" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/javascript/common.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/cleanheart/miscellaneous/sentence.html" class="nav-link">
  杂六
</a></div><div class="nav-item"><a href="https://github.com/Crayon-F" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/webpack/init.html" class="sidebar-link">1.初始化</a></li><li><a href="/interview/webpack/base.html" class="sidebar-link">2.基本配置</a></li><li><a href="/interview/webpack/optimization.html" class="sidebar-link">3.优化</a></li><li><a href="/interview/webpack/summary.html" aria-current="page" class="active sidebar-link">4.总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_1-原理简述" class="sidebar-link">1. 原理简述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_1-核心概念" class="sidebar-link">1.核心概念</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_2-工作流程-加载-编译-输出" class="sidebar-link">2.工作流程(加载-编译-输出)</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_2-loader" class="sidebar-link">2.loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_1-loader的特性" class="sidebar-link">1.loader的特性</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_2-常用loader" class="sidebar-link">2.常用loader</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_3-编写原则" class="sidebar-link">3.编写原则</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_3-plugin" class="sidebar-link">3.Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_1-事件流机制" class="sidebar-link">1.事件流机制</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/summary.html#_2-常用的plugin" class="sidebar-link">2.常用的plugin</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h1> <h2 id="_1-原理简述"><a href="#_1-原理简述" class="header-anchor">#</a> 1. 原理简述</h2> <h3 id="_1-核心概念"><a href="#_1-核心概念" class="header-anchor">#</a> 1.核心概念</h3> <p>javascript的模块<strong>打包工具</strong>(model bundler),通过分析各个模块中间的依赖，最终将代码打包成一份或者多份代码包(bundler),供HTML直接使用，实际上webpack仅仅提供了<strong>打包功能</strong>和<strong>文件处理机制</strong>,然后通过生态的各种loader和plugin对代码进行预编译和打包.因此webpack具有很高的拓展性，能更好的发挥社区的力量</p> <ul><li>Entry:入口文件，webpack从该文件开始进行分析编译</li> <li>Output:出口路径，打包后创建bundler的文件路径和文件名</li> <li>Module:模块，在webpack中任何一个文件都可以看成模块,会根据配置的不同loader进行加载和打包</li> <li>Chunk:代码块，可以根据配置将文件打包成一个或者多个代码块，以便按需加载提高性能</li> <li>Loader:模块加载器,将各个类型的文件加载和转换</li> <li>Plugin:拓展插件,可以通过webpack相应的事件钩子,介入到打包环境中的任意环节，对代码进行按需修改</li></ul> <h3 id="_2-工作流程-加载-编译-输出"><a href="#_2-工作流程-加载-编译-输出" class="header-anchor">#</a> 2.工作流程(加载-编译-输出)</h3> <ul><li>读取配置文件，按照命令<strong>初始化</strong>参数，创建compiler对象</li> <li>调用插件的apply方法<strong>挂载插件</strong>进行监听，然后从入口文件开始编译</li> <li>按照文件类型，调用相应的的loader对模板进行编译,并在合适的时机触发相应的事件，调用plugin执行，最后在根据模块<strong>依赖查找</strong>所依赖的模块，递归执行第三步</li> <li>将编译后的代码打包成一个个的代码块，并按依赖和配置确定<strong>输出内容</strong>，这个步骤扔可以通过plugin进行文件修改</li> <li>最后通过output把文件一一写入到指定文件中，完成打包过程</li></ul> <h2 id="_2-loader"><a href="#_2-loader" class="header-anchor">#</a> 2.loader</h2> <p>由于webpack是基于Node,因此webpack只能识别js代码，那html/css/图片等类型的文件则无法加载，因此需要对<strong>不同格式文件转换器</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">htmlSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 返回处理后的代码字符串</span>
	<span class="token comment">// 删除 html 文件中的所有注释</span>
	<span class="token keyword">return</span> htmlSource<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;!--[\w\W]*?--&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当然，实际的 Loader 不会这么简单，通常是需要将代码进行分析，构建 AST (抽象语法树)， 遍历进行定向的修改后，再重新生成新的代码字符串
Babel-loader 会执行以下步骤:</p> <ul><li>babylon 将 ES6/ES7 代码解析成 AST</li> <li>babel-traverse 对 AST 进行遍历转译，得到新的 AST</li> <li>新 AST 通过 babel-generator 转换成 ES5</li></ul> <h3 id="_1-loader的特性"><a href="#_1-loader的特性" class="header-anchor">#</a> 1.loader的特性</h3> <ul><li>链式传递 按照配置时相反的顺序链式执行</li> <li>基于Node环境，拥有较高的权限，对文件的增删改查</li> <li>可同步也可异步</li></ul> <h3 id="_2-常用loader"><a href="#_2-常用loader" class="header-anchor">#</a> 2.常用loader</h3> <ul><li>file-loader:加载文件资源，如字体/图片等，具有移动/复制/命名等功能</li> <li>url-loader:通常用于加载图片，对小的图片转换成Date url，减少请求</li> <li>babel-loader:加载js/jsx,将ES6/ES7转成es5，兼容性问题</li> <li>ts-loader:加载ts/tsx，编译typescript</li> <li>style-loader:将css已style标签的形式插入到HTML中</li> <li>css-loader:分析@import和url(),引入css和对应的资源</li> <li>less-loader/sass-loader:css预处理器</li></ul> <h3 id="_3-编写原则"><a href="#_3-编写原则" class="header-anchor">#</a> 3.编写原则</h3> <ul><li>单一原则:一个loader只做一件事</li> <li>链式调用：webpack只会按照顺序链式调用每个loader</li> <li>统一原则:遵循 Webpack 制定的设计规则和结构，输入与输出均为字符串，各个 Loader 完全独立，即插即用；</li></ul> <h2 id="_3-plugin"><a href="#_3-plugin" class="header-anchor">#</a> 3.Plugin</h2> <p>插件系统是webpack成功的一个关键因素,在编译的整个生命周期中，webpack会触发相应的钩子,plugin可以监听这些事件,根据需求在相应的时间点对打包内容进行定向修改</p> <ul><li>一个简单的plugin</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Plugin</span><span class="token punctuation">{</span>
  	<span class="token comment">// 注册插件时，会调用 apply 方法</span>
  	<span class="token comment">// apply 方法接收 compiler 对象</span>
  	<span class="token comment">// 通过 compiler 上提供的 Api，可以对事件进行监听，执行相应的操作</span>
  	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  		<span class="token comment">// compilation 是监听每次编译循环</span>
  		<span class="token comment">// 每次文件变化，都会生成新的 compilation 对象并触发该事件</span>
    	compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'compilation'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>注册插件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
	plugins<span class="token operator">:</span><span class="token punctuation">[</span>
		<span class="token keyword">new</span> <span class="token class-name">Plugin</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_1-事件流机制"><a href="#_1-事件流机制" class="header-anchor">#</a> 1.事件流机制</h3> <p>webpack就像工厂中的流水线，经过loader和plugin处理，最后进输出结果</p> <ul><li>通过链式调用串起一个个loader</li> <li>通过事件流机制,让plugin可以插入到整个生产过程中的每一个步骤
webpack事件流编程范式的核心是基础类Tapabel,是一种观察者模式的实现事件的订阅与广播</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'arg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 订阅</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 'event-hook'</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 广播</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'event-hook'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>webpack中最重要的类Compiler和Compilation都继承自Tapable,也拥有这样的事件流机制</p> <ul><li>Compiler:可以简单的理解为webpack的实例,它包含了webpack中所有的配置信息，如option,loader和plugin等信息,全局唯一，只有在启动时完成初始化创建,随着声明周期逐一传递</li> <li>Compilation:可以成为编译实例,当编译文件改变时,webpack可以创建一个新的compilation对象,开始新的一次编译。他包含了当前输入资源，输出资源，变化文件等，同时通过它提供的api，可以监听每次编译过程中触发的事件钩子</li> <li>区别</li></ul> <ol><li>Compiler 全局唯一，且从启动生存到结束；</li> <li>Compilation 对应每次编译，每轮编译循环均会重新创建；</li></ol> <h3 id="_2-常用的plugin"><a href="#_2-常用的plugin" class="header-anchor">#</a> 2.常用的plugin</h3> <ul><li>UglifyJsPlugin: 压缩、混淆代码；</li> <li>CommonsChunkPlugin: 代码分割；</li> <li>ProvidePlugin: 自动加载模块；</li> <li>html-webpack-plugin: 加载 html 文件，并引入 css / js 文件；</li> <li>extract-text-webpack-plugin / mini-css-extract-plugin: 抽离样式，生成 css 文件；</li> <li>DefinePlugin: 定义全局变量；</li> <li>optimize-css-assets-webpack-plugin: CSS 代码去重；</li> <li>webpack-bundle-analyzer: 代码分析；</li> <li>compression-webpack-plugin: 使用 gzip 压缩 js 和 css；</li> <li>happypack: 使用多进程，加速代码构建；</li> <li>EnvironmentPlugin: 定义环境变量；</li></ul> <p>作者：郭东东<br>
链接：<a href="https://juejin.im/post/5cc26dfef265da037b611738" target="_blank">https://juejin.im/post/5cc26dfef265da037b611738</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/26/2020, 10:10:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview/webpack/optimization.html" class="prev">
        3.优化
      </a></span> <span class="next"><a href="/interview/vue/init.html">
        基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ae35c946.js" defer></script><script src="/assets/js/4.7a9925ca.js" defer></script><script src="/assets/js/43.5cf73da3.js" defer></script>
  </body>
</html>
