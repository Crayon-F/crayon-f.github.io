<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack各种优化 | 蜡笔-小新</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta name="description" content="前端*前端">
    
    <link rel="preload" href="/assets/css/0.styles.59073369.css" as="style"><link rel="preload" href="/assets/js/app.ae35c946.js" as="script"><link rel="preload" href="/assets/js/4.7a9925ca.js" as="script"><link rel="preload" href="/assets/js/42.8d208f71.js" as="script"><link rel="prefetch" href="/assets/js/1.a85f77d0.js"><link rel="prefetch" href="/assets/js/10.4437fbd9.js"><link rel="prefetch" href="/assets/js/11.fc0caee6.js"><link rel="prefetch" href="/assets/js/12.9ae12081.js"><link rel="prefetch" href="/assets/js/13.a236975b.js"><link rel="prefetch" href="/assets/js/14.c970eefa.js"><link rel="prefetch" href="/assets/js/15.6ed1e1eb.js"><link rel="prefetch" href="/assets/js/16.da7bd798.js"><link rel="prefetch" href="/assets/js/17.ff8b8b21.js"><link rel="prefetch" href="/assets/js/18.daac6fd8.js"><link rel="prefetch" href="/assets/js/19.924e0828.js"><link rel="prefetch" href="/assets/js/20.e3a628d6.js"><link rel="prefetch" href="/assets/js/21.32f56551.js"><link rel="prefetch" href="/assets/js/22.6840f6f6.js"><link rel="prefetch" href="/assets/js/23.179fd3a2.js"><link rel="prefetch" href="/assets/js/24.051dea42.js"><link rel="prefetch" href="/assets/js/25.afb1d0c6.js"><link rel="prefetch" href="/assets/js/26.32d8d928.js"><link rel="prefetch" href="/assets/js/27.65e36429.js"><link rel="prefetch" href="/assets/js/28.2f4d7c6a.js"><link rel="prefetch" href="/assets/js/29.7b243c60.js"><link rel="prefetch" href="/assets/js/3.3a4b3e43.js"><link rel="prefetch" href="/assets/js/30.200349ab.js"><link rel="prefetch" href="/assets/js/31.0169f5d4.js"><link rel="prefetch" href="/assets/js/32.d7801ef7.js"><link rel="prefetch" href="/assets/js/33.998f2e93.js"><link rel="prefetch" href="/assets/js/34.25baceac.js"><link rel="prefetch" href="/assets/js/35.90337bb9.js"><link rel="prefetch" href="/assets/js/36.38257457.js"><link rel="prefetch" href="/assets/js/37.81238058.js"><link rel="prefetch" href="/assets/js/38.2d537690.js"><link rel="prefetch" href="/assets/js/39.81a6596a.js"><link rel="prefetch" href="/assets/js/40.d1a1ad8c.js"><link rel="prefetch" href="/assets/js/41.250ffa61.js"><link rel="prefetch" href="/assets/js/43.5cf73da3.js"><link rel="prefetch" href="/assets/js/5.91ba935f.js"><link rel="prefetch" href="/assets/js/6.59f2c097.js"><link rel="prefetch" href="/assets/js/7.7df142e3.js"><link rel="prefetch" href="/assets/js/8.c680a939.js"><link rel="prefetch" href="/assets/js/9.19cdaf0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.59073369.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">蜡笔-小新</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/javascript/common.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/cleanheart/miscellaneous/sentence.html" class="nav-link">
  杂六
</a></div><div class="nav-item"><a href="https://github.com/Crayon-F" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/javascript/common.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/cleanheart/miscellaneous/sentence.html" class="nav-link">
  杂六
</a></div><div class="nav-item"><a href="https://github.com/Crayon-F" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/webpack/init.html" class="sidebar-link">1.初始化</a></li><li><a href="/interview/webpack/base.html" class="sidebar-link">2.基本配置</a></li><li><a href="/interview/webpack/optimization.html" aria-current="page" class="active sidebar-link">3.优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_1-删除无用的css样式" class="sidebar-link">1.删除无用的Css样式</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_2-图片压缩插件" class="sidebar-link">2.图片压缩插件</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_3-cdn加载文件" class="sidebar-link">3.CDN加载文件</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_4-tree-shaking-scope-hoisting" class="sidebar-link">4.Tree-shaking &amp;&amp; Scope-Hoisting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_4-1-tree-shaking" class="sidebar-link">4.1 Tree-shaking</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_4-2-scope-hoisting" class="sidebar-link">4.2 Scope Hoisting</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_5-dllplugin-dllreferenceplugin" class="sidebar-link">5.DllPlugin &amp;&amp; DllReferencePlugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_5-1-dllplugin" class="sidebar-link">5.1 DllPlugin</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_5-2-dllreferenceplugin" class="sidebar-link">5.2 DllReferencePlugin</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_6-动态加载" class="sidebar-link">6.动态加载</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_7-打包文件分析工具" class="sidebar-link">7.打包文件分析工具</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_8-splitchunks" class="sidebar-link">8.SplitChunks</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_9-热更新" class="sidebar-link">9.热更新</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_10-ignoreplugin" class="sidebar-link">10.IgnorePlugin</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_11-费时分析" class="sidebar-link">11.费时分析</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_12-noparse" class="sidebar-link">12.noParse</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_13-resolve" class="sidebar-link">13.resolve</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_14-include-exclude" class="sidebar-link">14.include/exclude</a></li><li class="sidebar-sub-header"><a href="/interview/webpack/optimization.html#_15-happypack" class="sidebar-link">15.happypack</a></li></ul></li><li><a href="/interview/webpack/summary.html" class="sidebar-link">4.总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack各种优化"><a href="#webpack各种优化" class="header-anchor">#</a> webpack各种优化</h1> <p>上一章节我们已经掌握了webpack常见的所有配置</p> <p>这一节我们来看看如何实现webpack中的优化，我们先来编写最基本的webpack配置，然后依次实现各种优化！</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">mode</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> mode<span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">&quot;./src/main.js&quot;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span> <span class="token comment">// .babelrc已经配置支持react</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            mode <span class="token operator">!==</span> <span class="token string">&quot;development&quot;</span>
              <span class="token operator">?</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader
              <span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;css-loader&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 不匹配目录，只匹配文件</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode <span class="token operator">!==</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">&quot;css/[name].css&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">&quot;./src/template.html&quot;</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">&quot;index.html&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p><code>.babelrc</code>配置文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;@babel/preset-react&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_1-删除无用的css样式"><a href="#_1-删除无用的css样式" class="header-anchor">#</a> 1.删除无用的Css样式</h2> <p>先来看编写的代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">body</span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red
<span class="token punctuation">}</span>
<span class="token selector">.class1</span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>这里的<code>.class1</code>显然是无用的，我们可以搜索<code>src</code>目录下的文件，删除无用的样式</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 需要配合mini-css-extract-plugin插件</span>
mode <span class="token operator">!==</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 不匹配目录，只匹配文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_2-图片压缩插件"><a href="#_2-图片压缩插件" class="header-anchor">#</a> 2.图片压缩插件</h2> <p>将打包后的图片进行优化</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install image-webpack-loader --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在file-loader之前使用压缩图片插件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>loader<span class="token operator">:</span> <span class="token string">&quot;image-webpack-loader&quot;</span><span class="token punctuation">,</span>
options<span class="token operator">:</span> <span class="token punctuation">{</span>
  mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
    progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    quality<span class="token operator">:</span> <span class="token number">65</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// optipng.enabled: false will disable optipng</span>
  optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
    quality<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.90</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    speed<span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
    interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// the webp option will enable WEBP</span>
  webp<span class="token operator">:</span> <span class="token punctuation">{</span>
    quality<span class="token operator">:</span> <span class="token number">75</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>可以发现图片大小是有了明显的变化</p></blockquote> <h2 id="_3-cdn加载文件"><a href="#_3-cdn加载文件" class="header-anchor">#</a> 3.CDN加载文件</h2> <p>我们希望通过cdn的方式引入资源</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> AddAssetHtmlCdnPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-cdn-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlCdnPlugin</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token string">'jquery'</span><span class="token operator">:</span><span class="token string">'https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>但是在代码中还希望引入<code>jquery</code>来获得提示</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span>$<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>但是打包时依然会将<code>jquery</code>进行打包</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>externals<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token string">'jquery'</span><span class="token operator">:</span><span class="token string">'$'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在配置文件中标注<code>jquery</code>是外部的，这样打包时就不会将jquery进行打包了</p> <h2 id="_4-tree-shaking-scope-hoisting"><a href="#_4-tree-shaking-scope-hoisting" class="header-anchor">#</a> 4.Tree-shaking &amp;&amp; Scope-Hoisting</h2> <h3 id="_4-1-tree-shaking"><a href="#_4-1-tree-shaking" class="header-anchor">#</a> 4.1 Tree-shaking</h3> <p>顾名思义就是将没用的内容摇晃掉,来看下面代码</p> <p><code>main.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> minus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./calc&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>calc.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">'sum'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b <span class="token operator">+</span> <span class="token string">'minus'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>test.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>观察上述代码其实我们主要使用<code>minus</code>方法,<code>test.js</code>代码是有副作用的!</p></blockquote> <p>默认<code>mode:production</code>时，会自动<code>tree-shaking</code>,但是打包后<code>'hello'</code>依然会被打印出来,这时候我们需要配置不使用副作用</p> <p>在<code>package.json</code>中配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果这样设置，默认就不会导入<code>css</code>文件啦，因为我们引入css也是通过<code>import './style.css'</code></p> <p>这里重点就来了,<code>tree-shaking</code>主要针对<strong>es6模块</strong>,我们可以使用<code>require</code>语法导入css,但是这样用起来有点格格不入,所以我们可以配置<code>css</code>文件不是副作用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;**/*.css&quot;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在开发环境下默认<code>tree-shaking</code>不会生效,可以配置标识提示</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>optimization<span class="token operator">:</span><span class="token punctuation">{</span>
  usedExports<span class="token operator">:</span><span class="token boolean">true</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-2-scope-hoisting"><a href="#_4-2-scope-hoisting" class="header-anchor">#</a> 4.2 Scope Hoisting</h3> <p>作用域提升,可以减少代码体积，节约内存</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> d <span class="token operator">=</span> a<span class="token operator">+</span>b<span class="token operator">+</span>c
<span class="token keyword">export</span> <span class="token keyword">default</span> d<span class="token punctuation">;</span>
<span class="token comment">// 引入d</span>
<span class="token keyword">import</span> d <span class="token keyword">from</span> <span class="token string">'./d'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>最终打包后的结果会变成 <code>console.log(6)</code></p></blockquote> <ul><li>代码量明显减少</li> <li>减少多个函数后内存占用也将减少</li></ul> <h2 id="_5-dllplugin-dllreferenceplugin"><a href="#_5-dllplugin-dllreferenceplugin" class="header-anchor">#</a> 5.DllPlugin &amp;&amp; DllReferencePlugin</h2> <p>每次构建时第三方模块都需要重新构建，这个性能消耗比较大，我们可以先把第三方库打包成动态链接库，以后构建时只需要查找构建好的库就好了，这样可以大大节约构建时间</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_5-1-dllplugin"><a href="#_5-1-dllplugin" class="header-anchor">#</a> 5.1 DllPlugin</h3> <blockquote><p>这里我们可以先将<code>react</code>、<code>react-dom</code>单独进行打包</p></blockquote> <p>单独打包创建<code>webpack.dll.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span><span class="token string">'production'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'react.dll.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span><span class="token string">'react'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'react'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>执行<code>&quot;webpack --config webpack.dll.js</code>命令，可以看到dll目录下创建了两个文件分别是<code>manifest.json</code>,<code>react.dll.js</code></p> <p>关系是这个酱紫的，到时候我们会通过<code>manifest.json</code>找到<code>react.dll.js</code>文件中的模块进行加载</p> <h3 id="_5-2-dllreferenceplugin"><a href="#_5-2-dllreferenceplugin" class="header-anchor">#</a> 5.2 DllReferencePlugin</h3> <p>在我们的项目中可以引用刚才打包好的动态链接库</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllReferencePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AddAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 构建时会引用动态链接库的内容</span>
<span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  manifest<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">// 需要手动引入react.dll.js</span>
<span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/react.dll.js'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用DllPlugin可以大幅度提高构建速度</p> <h2 id="_6-动态加载"><a href="#_6-动态加载" class="header-anchor">#</a> 6.动态加载</h2> <p>实现点击后动态加载文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'点击加载视频'</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>给动态引入的文件增加名字</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>output<span class="token operator">:</span><span class="token punctuation">{</span>
  chunkFilename<span class="token operator">:</span><span class="token string">'[name].min.js'</span>
<span class="token punctuation">}</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;video&quot; */</span> <span class="token string">'./video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>这样打包后的结果最终的文件就是 <code>video.min.js</code></p></blockquote> <h2 id="_7-打包文件分析工具"><a href="#_7-打包文件分析工具" class="header-anchor">#</a> 7.打包文件分析工具</h2> <p>安装<code>webpack-bundle-analyzer</code>插件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install --save-dev webpack-bundle-analyzer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用插件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>BundleAnalyzerPlugin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mode <span class="token operator">!==</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>默认就会展现当前应用的分析图表</p> <h2 id="_8-splitchunks"><a href="#_8-splitchunks" class="header-anchor">#</a> 8.SplitChunks</h2> <p>我们在来看下SplitChunks这个配置，他可以在编译时抽离第三方模块、公共模块</p> <p>将项目配置成多入口文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>entry<span class="token operator">:</span><span class="token punctuation">{</span>
  a<span class="token operator">:</span><span class="token string">'./src/a.js'</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span><span class="token string">'./src/b.js'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们让a,b两个模块同时引用<code>jquery</code>,别忘了去掉之前的<code>externals</code>配置</p> <p><img src="http://img.fullstackjavascript.cn/analyze-1.png" alt=""></p> <p>配置<code>SplitChunks</code>插件</p> <p>默认配置在此，我一个个描述下含义</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
  chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 分割异步模块</span>
  minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 分割的文件最小大小</span>
  maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 引用次数</span>
  maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 最大异步请求数</span>
  maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 最大初始化请求数</span>
  automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 抽离的命名分隔符</span>
  automaticNameMaxLength<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 名字最大长度</span>
  name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存组</span>
    vendors<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 先抽离第三方</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
      minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// 优先级</span>
      reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>我们将<code>async</code>改为<code>initial</code></p></blockquote> <p><img src="http://img.fullstackjavascript.cn/analyze-2.png" alt=""></p> <p>我们在为每个文件动态导入<code>lodash</code>库,并且改成<code>async</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="http://img.fullstackjavascript.cn/analyze-3.png" alt=""></p> <blockquote><p>为每个入口引入<code>c.js</code>,并且改造配置文件</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
  chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
    vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      minSize<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 不是第三方模块，被引入两次也会被抽离</span>
      minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="http://img.fullstackjavascript.cn/analyze-4.png" alt=""></p> <blockquote><p>这样再反过来看<code>chunks</code>的参数是不是就了然于胸啦！</p></blockquote> <h2 id="_9-热更新"><a href="#_9-热更新" class="header-anchor">#</a> 9.热更新</h2> <p>模块热替换（HMR - Hot Module Replacement）是 webpack 提供的最有用的功能之一。它允许在运行时替换，添加，删除各种模块，而无需进行完全刷新重新加载整个页面</p> <ul><li>保留在完全重新加载页面时丢失的应用程序的状态</li> <li>只更新改变的内容，以节省开发时间</li> <li>调整样式更加快速，几乎等同于就在浏览器调试器中更改样式</li></ul> <p>启用热更新，默认样式可以支持热更新，如果不支持热更新则采用强制刷新</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>devServer<span class="token operator">:</span><span class="token punctuation">{</span>
  hot<span class="token operator">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>让<code>js</code>支持热更新</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> sum <span class="token keyword">from</span> <span class="token string">'./sum'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 如果支持热更新</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当入口文件变化后重新执行当前入口文件</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_10-ignoreplugin"><a href="#_10-ignoreplugin" class="header-anchor">#</a> 10.IgnorePlugin</h2> <p>忽略 <code>import</code>和<code>require</code>语法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_11-费时分析"><a href="#_11-费时分析" class="header-anchor">#</a> 11.费时分析</h2> <p>可以计算每一步执行的运行速度</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span>smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_12-noparse"><a href="#_12-noparse" class="header-anchor">#</a> 12.noParse</h2> <p><code>module.noParse</code>，对类似jq这类依赖库，内部不会引用其他库，我们在打包的时候就没有必要去解析，这样能够增加打包速率</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>noParse<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery</span><span class="token regex-delimiter">/</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_13-resolve"><a href="#_13-resolve" class="header-anchor">#</a> 13.resolve</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.json&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  alias<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_14-include-exclude"><a href="#_14-include-exclude" class="header-anchor">#</a> 14.include/exclude</h2> <p>在使用<code>loader</code>时,可以指定哪些文件不通过<code>loader</code>,或者指定哪些文件通过<code>loader</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// include:path.resolve(__dirname,'src'),</span>
  exclude<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_15-happypack"><a href="#_15-happypack" class="header-anchor">#</a> 15.happypack</h2> <p>多线程打包，我们可以将不同的逻辑交给不同的线程来处理</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev happypack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用插件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rules<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token string">'happypack/loader?id=jsx'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token string">'happypack/loader?id=styles'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span>
  threads<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'babel-loader'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'styles'</span><span class="token punctuation">,</span>
  threads<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/31/2020, 8:04:01 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview/webpack/base.html" class="prev">
        2.基本配置
      </a></span> <span class="next"><a href="/interview/webpack/summary.html">
        4.总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ae35c946.js" defer></script><script src="/assets/js/4.7a9925ca.js" defer></script><script src="/assets/js/42.8d208f71.js" defer></script>
  </body>
</html>
